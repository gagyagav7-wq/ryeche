generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// --- TABEL UTAMA APLIKASI ---

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
}

model movies {
  url         String  @id
  title       String?
  synopsis    String?
  poster      String?
  iframe_link String?
  scraped_at  Int?
  status      String?
  stream_link String?

  categories  movie_categories[]  // ✅ relation list

  @@index([status], map: "idx_movies_status")
  @@map("movies")
}

model movie_categories {
  url      String
  category String

  movie    movies @relation(fields: [url], references: [url], onDelete: Cascade) // ✅ relation

  @@id([url, category])
  @@map("movie_categories")
}

// --- TABEL SCRAPER (LOGS) ---
// Dibiarkan ignore karena cuma buat log bot scraper, gak dipake di web

model checkpoints {
  category_url String? @id
  last_page    Int?
  status       String?
  updated_at   Int?

  @@ignore
}

model crawl_errors {
  url          String?
  category     String?
  stage        String?
  error_detail String?
  scraped_at   Int?
  resolved     Int?    @default(0)

  @@index([resolved], map: "idx_errors_resolved")
  @@ignore
}
